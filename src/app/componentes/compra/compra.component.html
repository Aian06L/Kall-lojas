<div class="checkout-container">
  <!-- Header do Checkout -->
  <div class="checkout-header">
    <h1>
      <i class="bi bi-credit-card-2-back"></i>
      Finalizar Compra
    </h1>
    <p class="subtitle">Complete os dados abaixo para finalizar seu pedido</p>
  </div>

  <!-- Indicador de progresso -->
  <div class="progress-indicator">
    <div class="step" [class.active]="currentStep >= 1" [class.completed]="currentStep > 1">
      <div class="step-number">1</div>
      <div class="step-label">Dados Pessoais</div>
    </div>
    <div class="step" [class.active]="currentStep >= 2" [class.completed]="currentStep > 2">
      <div class="step-number">2</div>
      <div class="step-label">Endereço</div>
    </div>
    <div class="step" [class.active]="currentStep >= 3">
      <div class="step-number">3</div>
      <div class="step-label">Pagamento</div>
    </div>
  </div>

  <div class="checkout-content">
    <!-- Coluna do formulário -->
    <div class="form-column">
      <form [formGroup]="checkoutForm">
        
        <!-- Etapa 1: Dados Pessoais -->
        <div class="checkout-step" *ngIf="currentStep === 1">
          <h3>
            <i class="bi bi-person-circle"></i>
            Dados Pessoais
          </h3>
          
          <div class="form-group">
            <label for="fullName">Nome Completo *</label>
            <input 
              type="text" 
              id="fullName" 
              formControlName="fullName"
              [class.error]="isFieldInvalid('fullName')"
              placeholder="Digite seu nome completo"
            >
            <div class="error-message" *ngIf="isFieldInvalid('fullName')">
              {{ getFieldError('fullName') }}
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="email">Email *</label>
              <input 
                type="email" 
                id="email" 
                formControlName="email"
                [class.error]="isFieldInvalid('email')"
                placeholder="seu@email.com"
              >
              <div class="error-message" *ngIf="isFieldInvalid('email')">
                {{ getFieldError('email') }}
              </div>
            </div>
            
            <div class="form-group">
              <label for="phone">Telefone *</label>
              <input 
                type="tel" 
                id="phone" 
                formControlName="phone"
                [class.error]="isFieldInvalid('phone')"
                placeholder="(11) 99999-9999"
              >
              <div class="error-message" *ngIf="isFieldInvalid('phone')">
                {{ getFieldError('phone') }}
              </div>
            </div>
          </div>
        </div>

        <!-- Etapa 2: Endereço -->
        <div class="checkout-step" *ngIf="currentStep === 2">
          <h3>
            <i class="bi bi-geo-alt-fill"></i>
            Endereço de Entrega
          </h3>
          
          <div class="form-row">
            <div class="form-group">
              <label for="zipCode">CEP *</label>
              <input 
                type="text" 
                id="zipCode" 
                formControlName="zipCode"
                [class.error]="isFieldInvalid('zipCode')"
                placeholder="00000-000"
              >
              <div class="error-message" *ngIf="isFieldInvalid('zipCode')">
                {{ getFieldError('zipCode') }}
              </div>
            </div>
          </div>

          <div class="form-group">
            <label for="street">Rua/Avenida *</label>
            <input 
              type="text" 
              id="street" 
              formControlName="street"
              [class.error]="isFieldInvalid('street')"
              placeholder="Nome da rua"
            >
            <div class="error-message" *ngIf="isFieldInvalid('street')">
              {{ getFieldError('street') }}
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="number">Número *</label>
              <input 
                type="text" 
                id="number" 
                formControlName="number"
                [class.error]="isFieldInvalid('number')"
                placeholder="123"
              >
              <div class="error-message" *ngIf="isFieldInvalid('number')">
                {{ getFieldError('number') }}
              </div>
            </div>
            
            <div class="form-group">
              <label for="complement">Complemento</label>
              <input 
                type="text" 
                id="complement" 
                formControlName="complement"
                placeholder="Apto, bloco..."
              >
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="neighborhood">Bairro *</label>
              <input 
                type="text" 
                id="neighborhood" 
                formControlName="neighborhood"
                [class.error]="isFieldInvalid('neighborhood')"
                placeholder="Nome do bairro"
              >
              <div class="error-message" *ngIf="isFieldInvalid('neighborhood')">
                {{ getFieldError('neighborhood') }}
              </div>
            </div>
            
            <div class="form-group">
              <label for="city">Cidade *</label>
              <input 
                type="text" 
                id="city" 
                formControlName="city"
                [class.error]="isFieldInvalid('city')"
                placeholder="Nome da cidade"
              >
              <div class="error-message" *ngIf="isFieldInvalid('city')">
                {{ getFieldError('city') }}
              </div>
            </div>
            
            <div class="form-group">
              <label for="state">Estado *</label>
              <select 
                id="state" 
                formControlName="state"
                [class.error]="isFieldInvalid('state')"
              >
                <option value="">Selecione</option>
                <option value="SP">São Paulo</option>
                <option value="RJ">Rio de Janeiro</option>
                <option value="MG">Minas Gerais</option>
                <option value="RS">Rio Grande do Sul</option>
                <!-- Adicione outros estados conforme necessário -->
              </select>
              <div class="error-message" *ngIf="isFieldInvalid('state')">
                {{ getFieldError('state') }}
              </div>
            </div>
          </div>
        </div>

        <!-- Etapa 3: Pagamento -->
        <div class="checkout-step" *ngIf="currentStep === 3">
          <h3>
            <i class="bi bi-credit-card"></i>
            Método de Pagamento
          </h3>
          
          <div class="payment-methods">
            <label class="payment-option">
              <input type="radio" formControlName="paymentMethod" value="credit">
              <div class="payment-card">
                <i class="bi bi-credit-card-fill"></i>
                <span>Cartão de Crédito</span>
              </div>
            </label>
            
            <label class="payment-option">
              <input type="radio" formControlName="paymentMethod" value="debit">
              <div class="payment-card">
                <i class="bi bi-credit-card-2-front"></i>
                <span>Cartão de Débito</span>
              </div>
            </label>
            
            <label class="payment-option">
              <input type="radio" formControlName="paymentMethod" value="pix">
              <div class="payment-card">
                <i class="bi bi-qr-code"></i>
                <span>PIX</span>
              </div>
            </label>
          </div>

          <!-- Dados do cartão (se necessário) -->
          <div *ngIf="checkoutForm.get('paymentMethod')?.value === 'credit' || checkoutForm.get('paymentMethod')?.value === 'debit'" class="card-details">
            <div class="form-group">
              <label for="cardNumber">Número do Cartão *</label>
              <input 
                type="text" 
                id="cardNumber" 
                formControlName="cardNumber"
                [class.error]="isFieldInvalid('cardNumber')"
                placeholder="1234 5678 9012 3456"
              >
              <div class="error-message" *ngIf="isFieldInvalid('cardNumber')">
                {{ getFieldError('cardNumber') }}
              </div>
            </div>

            <div class="form-group">
              <label for="cardHolder">Nome no Cartão *</label>
              <input 
                type="text" 
                id="cardHolder" 
                formControlName="cardHolder"
                [class.error]="isFieldInvalid('cardHolder')"
                placeholder="Nome como aparece no cartão"
              >
              <div class="error-message" *ngIf="isFieldInvalid('cardHolder')">
                {{ getFieldError('cardHolder') }}
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="expiryDate">Validade *</label>
                <input 
                  type="text" 
                  id="expiryDate" 
                  formControlName="expiryDate"
                  [class.error]="isFieldInvalid('expiryDate')"
                  placeholder="MM/AA"
                >
                <div class="error-message" *ngIf="isFieldInvalid('expiryDate')">
                  {{ getFieldError('expiryDate') }}
                </div>
              </div>
              
              <div class="form-group">
                <label for="cvv">CVV *</label>
                <input 
                  type="text" 
                  id="cvv" 
                  formControlName="cvv"
                  [class.error]="isFieldInvalid('cvv')"
                  placeholder="123"
                >
                <div class="error-message" *ngIf="isFieldInvalid('cvv')">
                  {{ getFieldError('cvv') }}
                </div>
              </div>
            </div>
          </div>
        </div>
      </form>

      <!-- Botões de navegação -->
      <div class="navigation-buttons">
        <button 
          type="button" 
          class="btn-secondary"
          *ngIf="currentStep > 1"
          (click)="previousStep()"
        >
          <i class="bi bi-arrow-left"></i>
          Voltar
        </button>
        
        <button 
          type="button" 
          class="btn-primary"
          *ngIf="currentStep < 3"
          (click)="nextStep()"
        >
          Continuar
          <i class="bi bi-arrow-right"></i>
        </button>
        
        <button 
          type="button" 
          class="btn-success"
          *ngIf="currentStep === 3"
          (click)="finalizePurchase()"
          [disabled]="isProcessing"
        >
          <i class="bi bi-check-circle" *ngIf="!isProcessing"></i>
          <i class="bi bi-arrow-clockwise spin" *ngIf="isProcessing"></i>
          {{ isProcessing ? 'Processando...' : 'Finalizar Compra' }}
        </button>
      </div>
    </div>

    <!-- Coluna do resumo -->
    <div class="summary-column">
      <div class="order-summary-card">
        <h3>
          <i class="bi bi-receipt"></i>
          Resumo do Pedido
        </h3>
        
        <!-- Lista de itens -->
        <div class="order-items">
          <div class="order-item" *ngFor="let item of cartItems">
            <img [src]="item.image || '/assets/placeholder-product.jpg'" [alt]="item.name">
            <div class="item-info">
              <h5>{{ item.name }}</h5>
              <p>Qtd: {{ item.quantity }}</p>
            </div>
            <div class="item-price">
              R$ {{ (item.price * item.quantity).toFixed(2).replace('.', ',') }}
            </div>
          </div>
        </div>

        <!-- Totais -->
        <div class="order-totals">
          <div class="total-row">
            <span>Subtotal ({{ totalQuantity }} {{ totalQuantity === 1 ? 'item' : 'itens' }}):</span>
            <span>R$ {{ totalPrice.toFixed(2).replace('.', ',') }}</span>
          </div>
          <div class="total-row">
            <span>Frete:</span>
            <span class="free">Grátis</span>
          </div>
          <hr>
          <div class="total-row final-total">
            <span>Total:</span>
            <span>R$ {{ totalPrice.toFixed(2).replace('.', ',') }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
