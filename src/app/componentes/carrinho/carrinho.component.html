<div class="carrinho-wrapper">
  <div class="carrinho-container">
    <div class="carrinho-header">
      <h2>
        <i class="bi bi-cart3"></i>
        Meu Carrinho de Compras
      </h2>
      <p class="subtitle" *ngIf="totalQuantity > 0">
        Você tem {{ totalQuantity }} {{ totalQuantity === 1 ? 'item' : 'itens' }} no seu carrinho
      </p>
    </div>

    <!-- Lista de produtos no carrinho -->
    <div *ngIf="cartItems.length > 0; else emptyCart" class="carrinho-content">
      <div class="items-container">
        <div class="cart-item" *ngFor="let item of cartItems; trackBy: trackByItemId">
          <div class="item-image">
            <img [src]="item.image || '/assets/placeholder-product.jpg'" [alt]="item.name" />
          </div>
          
          <div class="item-details">
            <h5>{{ item.name }}</h5>
            <div class="item-price">R$ {{ item.price | number:'1.2-2' }}</div>
          </div>

          <div class="item-quantity">
            <label for="qty-{{ item.id }}" class="quantity-label">Quantidade:</label>
            <div class="quantity-controls">
              <button 
                class="btn-quantity btn-decrease" 
                (click)="decreaseQuantity(item.id)"
                [disabled]="item.quantity <= 1"
              >
                <i class="bi bi-dash"></i>
              </button>
              <input 
                type="number" 
                id="qty-{{ item.id }}"
                [value]="item.quantity" 
                (input)="updateQuantity(item.id, $any($event.target).value)" 
                min="1" 
                max="99"
                class="quantity-input"
              />
              <button 
                class="btn-quantity btn-increase" 
                (click)="increaseQuantity(item.id)"
                [disabled]="item.quantity >= 99"
              >
                <i class="bi bi-plus"></i>
              </button>
            </div>
          </div>

          <div class="item-subtotal">
            <span class="subtotal-label">Subtotal:</span>
            <span class="subtotal-value">R$ {{ (item.quantity * item.price).toFixed(2) }}</span>
          </div>

          <div class="item-actions">
            <button 
              class="btn-remove" 
              (click)="removeItem(item.id)"
              title="Remover item do carrinho"
            >
              <i class="bi bi-trash"></i>
              Remover
            </button>
          </div>
        </div>
      </div>

      <!-- Resumo do pedido -->
      <div class="order-summary">
        <div class="summary-card">
          <h3>
            <i class="bi bi-receipt"></i>
            Resumo do Pedido
          </h3>
          
          <div class="summary-details">
            <div class="summary-row">
              <span>Quantidade de itens:</span>
              <span>{{ totalQuantity }}</span>
            </div>
            <div class="summary-row">
              <span>Subtotal:</span>
              <span>R$ {{ totalPrice.toFixed(2) }}</span>
            </div>
            <div class="summary-row">
              <span>Frete:</span>
              <span class="free-shipping">Grátis</span>
            </div>
            <hr class="summary-divider">
            <div class="summary-row total-row">
              <span>Total a pagar:</span>
              <span class="total-price">R$ {{ totalPrice.toFixed(2) }}</span>
            </div>
          </div>

          <div class="checkout-actions">
            <button class="btn-checkout" (click)="proceedToCheckout()">
              <i class="bi bi-credit-card"></i>
              Finalizar Compra
            </button>
            
            <button class="btn-clear" (click)="clearCart()">
              <i class="bi bi-trash"></i>
              Limpar Carrinho
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Carrinho vazio -->
    <ng-template #emptyCart>
      <div class="empty-cart">
        <div class="empty-cart-icon">
          <i class="bi bi-cart-x"></i>
        </div>
        <h3>Seu carrinho está vazio</h3>
        <p>Que tal dar uma olhada em nossos produtos incríveis?</p>
        <button class="btn-shop-now" routerLink="/home">
          <i class="bi bi-bag-plus"></i>
          Começar a Comprar
        </button>
      </div>
    </ng-template>
  </div>
</div>

<!-- Modal de Pagamento -->
<app-pagamento
  *ngIf="showPaymentModal"
  [showModal]="showPaymentModal"
  [items]="cartItems"
  [total]="totalPrice"
  (closeModal)="closePaymentModal()"
  (paymentComplete)="onPaymentComplete($event)">
</app-pagamento>
